{% extends 'base.html' %}

{% block content %}
<div class="container mt-5">
    <div class="card shadow p-4">
        <h2 class="mb-4">Editar Usuario</h2>
        <form method="post">
            {% csrf_token %}

            <!-- Campos estáticos -->
            <div class="mb-3">
                <label class="form-label">Nombre</label>
                <input type="text" value="{{ usuario.first_name }}" class="form-control" readonly>
            </div>

            <div class="mb-3">
                <label class="form-label">Apellido</label>
                <input type="text" value="{{ usuario.last_name }}" class="form-control" readonly>
            </div>

            <!-- Cédula editable -->
            <div class="mb-3">
                <label class="form-label">Cédula</label>
                <input type="text" name="cedula" value="{{ usuario.cedula }}" class="form-control">
            </div>

            <!-- Campos editables -->
            <div class="mb-3">
                <label class="form-label">Teléfono</label>
                <input type="text" name="telefono" value="{{ perfil.telefono }}" class="form-control">
            </div>

            <div class="mb-3">
                <label class="form-label">Correo</label>
                <input type="email" name="correo" value="{{ usuario.email }}" class="form-control">
            </div>

            <div class="mb-3">
                <label class="form-label">Dirección</label>
                <input type="text" name="direccion" value="{{ usuario.direccion }}" class="form-control">
            </div>

            <div class="mb-3">
                <label class="form-label">Departamento</label>
                <select name="departamento" id="departamento" class="form-select">
                    <option value="">Seleccione un departamento</option>
                    <option value="Cundinamarca" {% if perfil.departamento == "Cundinamarca" %}selected{% endif %}>Cundinamarca</option>
                    <option value="Antioquia" {% if perfil.departamento == "Antioquia" %}selected{% endif %}>Antioquia</option>
                    <option value="Valle del Cauca" {% if perfil.departamento == "Valle del Cauca" %}selected{% endif %}>Valle del Cauca</option>
                    <option value="Bogotá" {% if perfil.departamento == "Bogotá" %}selected{% endif %}>Bogotá</option>
                </select>
            </div>

            <div class="mb-3">
                <label class="form-label">Ciudad</label>
                <select name="ciudad" id="ciudad" class="form-select">
                    <option value="">Seleccione una ciudad</option>
                </select>
            </div>

            <!-- Botones -->
            <button type="submit" class="btn btn-primary">Guardar</button>
            <a href="{{ cancelar_url }}" class="btn btn-secondary">Cancelar</a>
        </form>
    </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", function () {
    const departamentoSelect = document.getElementById("departamento");
    const ciudadSelect = document.getElementById("ciudad");

    const ciudadesPorDepartamento = {
        "Cundinamarca": ["Girardot", "Soacha", "Fusagasugá", "Zipaquirá", "Ricaurte"],
        "Antioquia": ["Medellín", "Envigado", "Bello", "Itagüí"],
        "Valle del Cauca": ["Cali", "Palmira", "Buenaventura", "Tuluá"],
        "Bogotá": ["Bogotá"]
    };

    function actualizarCiudades() {
        const deptSeleccionado = departamentoSelect.value;
        ciudadSelect.innerHTML = '';

        if (ciudadesPorDepartamento[deptSeleccionado]) {
            ciudadSelect.disabled = false;
            ciudadSelect.appendChild(new Option("Seleccione una ciudad", ""));
            ciudadesPorDepartamento[deptSeleccionado].forEach(function (ciudad) {
                const opt = new Option(ciudad, ciudad);
                if (ciudad === "{{ perfil.ciudad }}") {
                    opt.selected = true;
                }
                ciudadSelect.appendChild(opt);
            });
        } else {
            ciudadSelect.disabled = true;
            ciudadSelect.appendChild(new Option("Seleccione una ciudad", ""));
        }
    }

    departamentoSelect.addEventListener("change", actualizarCiudades);
    actualizarCiudades(); // inicializa las ciudades al cargar
});
</script>
{% endblock %}
