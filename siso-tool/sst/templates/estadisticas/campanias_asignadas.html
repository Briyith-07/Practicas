{% extends 'base.html' %}
{% block title %}Campa침as Asignadas{% endblock %}

{% block content %}
<div class="container mt-5">
  <h2 class="text-center mb-4">游늶 Campa침as Asignadas</h2>

  <!-- Tabla primero -->
  <div class="card shadow-sm border-0">
    <div class="card-body p-0">
      <table class="table table-striped table-hover m-0">
        <thead class="table-dark">
          <tr>
            <th>C칩digo</th>
            <th>Nombre</th>
            <th>Detalle</th>
            <th>Estado</th>
            <th>Periodicidad</th>
            <th>Empleado Asignado</th>
            <th>Fecha Asignaci칩n</th>
          </tr>
        </thead>
        <tbody>
          {% for asignacion in asignadas %}
          <tr>
            <td>{{ asignacion.campa침a.codigo.codigo }}</td>
            <td>{{ asignacion.campa침a.codigo.nombre }}</td>
            <td>{{ asignacion.campa침a.detalle }}</td>
            <td>
              {% if asignacion.campa침a.estado == 'activa' %}
                <span class="badge bg-success">Activa</span>
              {% elif asignacion.campa침a.estado == 'pausada' %}
                <span class="badge bg-warning text-dark">Pausada</span>
              {% elif asignacion.campa침a.estado == 'finalizada' %}
                <span class="badge bg-secondary">Finalizada</span>
              {% else %}
                <span class="badge bg-light text-dark">{{ asignacion.campa침a.estado }}</span>
              {% endif %}
            </td>
            <td>{{ asignacion.campa침a.periodicidad }}</td>
            <td>{{ asignacion.empleado.first_name }} {{ asignacion.empleado.last_name }}</td>
            <td>{{ asignacion.fecha_asignacion|date:"Y-m-d H:i" }}</td>
          </tr>
          {% empty %}
          <tr>
            <td colspan="7" class="text-center">No hay campa침as asignadas.</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>

  <!-- Gr치fico debajo -->
  <div class="card mt-5 shadow-sm p-4">
    <h5 class="mb-3">游늵 Resumen de asignaciones por campa침a</h5>
    <canvas id="graficoAsignaciones" height="100"></canvas>
  </div>

  <div class="text-center mt-4">
    <a href="{% url 'estadisticas_campa침as' %}" class="btn btn-secondary">拘勇 Volver al men칰</a>
  </div>
</div>

<!-- Chart.js y script para gr치fico -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  const resumenAsignaciones = {{ resumen_asignaciones|safe }};
  const labels = resumenAsignaciones.map(item => item.nombre);
  const datos = resumenAsignaciones.map(item => item.cantidad);

  new Chart(document.getElementById('graficoAsignaciones'), {
    type: 'bar',
    data: {
      labels: labels,
      datasets: [{
        label: 'Asignaciones',
        data: datos,
        backgroundColor: '#4FC3F7',
        borderColor: '#0288D1',
        borderWidth: 1
      }]
    },
    options: {
      responsive: true,
      plugins: {
        legend: { display: false },
        title: {
          display: true,
          text: 'Asignaciones por Campa침a'
        }
      },
      scales: {
        y: {
          beginAtZero: true,
          title: { display: true, text: 'Cantidad' }
        },
        x: {
          title: { display: true, text: 'Campa침a' }
        }
      }
    }
  });
</script>
{% endblock %}
